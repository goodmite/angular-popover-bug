<!--<p>{{selectedTemplateKeyOutputIndex|json}}</p>-->
<div class="genTempGrid child-expand">
  <!--left sidebar starts-->
  <div class="genTempGridItem left-sidebar intent-header ml-1 position-relative">
    <div
      style="position: absolute; top: 0; left: 0; right: 0; max-height: 100%; z-index: 10; overflow-y: auto; overflow-x: hidden">
      <div class="d-flex" style="align-items:center;">
        <div class="text-bold">Templates</div>
        <div class="ml-auto text-theme-primary pr-2 new-intent-btn cursor-pointer d-flex align-item-center"
             style="color: #00abd3;"
             (click)="openNewIntentModal(IntentModal)">
          <i class="fa fa-plus pr-1 my-auto"></i>Add New
        </div>
      </div>
      <input *ngIf="templateKeyDict && myObject.keys(templateKeyDict) && myObject.keys(templateKeyDict).length>0;"
             type="text" placeholder="Search Intent" [(ngModel)]="templateKeySearchKeyword">
      <div class="d-flex align-items-center show-on-hover"
           *ngFor="let tempKey of myObject.keys(templateKeyDict||{})|filterTemplateLeyList:templateKeySearchKeyword">
        <div class="pl-2 p-1 mr-1 flex-grow-1 tab-theme limit-oneline"
             style="border-radius: 2px"
             [ngClass]="{'font-weight-bold':selectedTemplateKeyInLeftSideBar === tempKey}"
             (click)="selectedTemplateKeyInLeftSideBar = tempKey;selectedTemplateKeyOutputIndex = [];">{{tempKey}}
        </div>
        <i class="fa fa-edit mr-1 cursor-pointer hide-it" style="color: #9e9e9e"
           (click)="templateKeyToBeDeleted.value= tempKey; openEditTemplateKeyModal(EditTemplateKeyModal);"></i>
        <i class="fa fa-trash mx-2 cursor-pointer hide-it" style="color: #9e9e9e"
           (click)="templateKeyToBeDeleted.value= tempKey;openDeleteTemplateKeyModal(deleteTemplateKeyModal)"></i>
      </div>

    </div>

    <div *ngIf="!(templateKeyDict && myObject.keys(templateKeyDict) && myObject.keys(templateKeyDict).length>0)"
         class="d-flex align-items-center" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0;">
      <div class="align-self-center mx-2 text-center" style="color: #9e9e9e;">
        Add new template key to start adding responses
      </div>
    </div>
  </div>
  <!--left sidebar ends-->

  <div class="center-header d-flex justify-content-between align-items-center">
    <div class="response-test px-2">
      Response Flow {{templateKeyDict && selectedTemplateKeyInLeftSideBar &&
      templateKeyDict[selectedTemplateKeyInLeftSideBar] &&
      ((templateKeyDict[selectedTemplateKeyInLeftSideBar]|dataType)!=='string') ?
      ('('+templateKeyDict[selectedTemplateKeyInLeftSideBar].length+')'):""}}
    </div>
    <div class="form-group m-0 channel-drop d-flex align-items-center">
      <label class="px-2 my-0" *ngIf="channelList && channelList.length>0">Channel</label>
      <form #channelSelectorForm="ngForm" class="position-relative"
            [hidden]="!channelList || channelList.length<1">
        <img style="position: absolute; width: 15px; height: 15px; top: 50%; transform: translate(5px, -50%)"
             [src]="(selectedChannelOfGenTemplate?.name|logosByIntegrationName)?.icon" alt="">
        <select id="gentemplate-channel-selector" required name="name" ngModel>
          <option *ngFor="let channel of channelList" type="button" [value]="channel.name">
            {{channel.displayName}}
          </option>
        </select>
      </form>
      <!--<ng-template #noChannelsMessageTemplate>-->
        <i class="text-danger" *ngIf="!channelList || channelList.length<1" style="font-size: 11px">No Channels</i>
      <!--</ng-template>-->
    </div>
  </div>


  <div #genTempGridItemGrid class="genTempGridItemGrid " style="position: relative">

    <div *ngIf="!(templateKeyDict && myObject.keys(templateKeyDict) && myObject.keys(templateKeyDict).length>0)"
         class="d-flex align-items-center justify-content-center mx-5 px-5"
         style="position: absolute; top: 0; left: 0; right: 0; bottom: 0;">
      <div class="text-center d-flex flex-wrap justify-content-center mx-5 px-5" style="color: #9e9e9e;">
        <div class="bg-white d-flex justify-content-center align-items-center"
             style="height: 56px; width: 56px; border-radius: 28px">
          <!--<i class="fa fa-cloud" style="color: #00abd3"></i>-->
          <i class="fa fa-commenting" style="color: #00abd3; font-size: 25px"></i>
        </div>
        <div class="w-100">Start configuring responses by adding a new template key from the left panel</div>
      </div>
    </div>

    <!--if the value of template key is unpasable, we will show response components-->
    <!--response components list start-->
    <div class="intentItems position-relative ">
      <!--<div #scrollMe class="" style="position: absolute; top: 0; left: 0; right: 0; min-height: 100%; max-height: 100%; overflow-y: auto; overflow-x: hidden">-->
      <div class="" id="template-output-scroll-container">
        <ng-container
          *ngIf="templateKeyDict && (templateKeyDict[selectedTemplateKeyInLeftSideBar]|dataType)!=='string'">
          <div class="py-1 px-0 mb-3"
               *ngFor="let outputItem of templateKeyDict[selectedTemplateKeyInLeftSideBar]|filterResponseComponentByChannelName:selectedChannelOfGenTemplate?.name; let i = index">
            <app-code-gentemplate-ui-component-wrapper
              [outputItem]="outputItem"
              #gentemplateItem class="gentemplateItem"
              [myIndex]=i
              [channelList]="channelList"
              [totalResponseTemplateComponentCount]="myObject.keys(templateKeyDict[selectedTemplateKeyInLeftSideBar]).length"
              [selectedTemplateKeyOutputIndex]="selectedTemplateKeyOutputIndex"
              (deleteTemplate)="deleteGentemplate($event)"
              (moveTempUp)="moveUpGentempate($event)"
              (moveTempDown)="moveDownGentempate($event)"
              (selectionChanged)="selectGentempate($event)">
            </app-code-gentemplate-ui-component-wrapper>


          </div>
        </ng-container>

        <!--if the value of template key is unparsable, we will show code editor-->
        <!--<ng-container *ngIf="isTemplateKeyOutputUnparsable()">-->
        <!--<div class="intentItems d-flex-column-last-child-flex-grow-1">-->
        <!--<div class="d-flex-column-last-child-flex-grow-1 child-expand">-->
        <!--<app-code-editor class="d-flex-column-last-child-flex-grow-1 child-expand"-->
        <!--[text]="{text:templateKeyDict[selectedTemplateKeyInLeftSideBar]}"-->
        <!--(textChangedEvent)="updateSelectedTemplateKeyValue($event)"></app-code-editor>-->
        <!--</div>-->
        <!--</div>-->
        <!--</ng-container>-->


        <div style="height: 150px; visibility: hidden"></div>
      </div>
    </div>
    <!--response components list ends-->
<!---->
    <!--if the value of template key is unparsable, we will show code editor-->
    <ng-container *ngIf="isTemplateKeyOutputUnparsable()">
      <div class="intentItems d-flex-column-last-child-flex-grow-1">
        <div class="d-flex-column-last-child-flex-grow-1 child-expand">
          <app-code-editor class="d-flex-column-last-child-flex-grow-1 child-expand"
                           [doValidationsIcon]="false"
                           [doShowUploadDownloadButton]="false"
                           [text]="{text:templateKeyDictClone[selectedTemplateKeyInLeftSideBar]}"
                           (textChangedEvent)="updateSelectedTemplateKeyValue($event)"></app-code-editor>
        </div>
      </div>
    </ng-container>
    <!--fixed at bottom-->
    <div *ngIf="selectedTemplateKeyOutputIndex && selectedTemplateKeyOutputIndex.length>0"
         class="selected-templates d-flex m-2 px-2"
         style="position: absolute; bottom: 0; left: 0; right: 0; z-index: 200">
      <div>{{selectedTemplateKeyOutputIndex.length}} response selected</div>
      <div class="ml-auto color-primary cursor-pointer" (click)="selectedListCopyModel(IntentSelectionModal)"><i
        class="fa f0c5 fa-upload">
      </i> Copy to
      </div>
      <div class="color-primary ml-2 cursor-pointer" (click)="selectedListDuplicate()"><i class="fa fa-copy ">
      </i>
        Duplicate
      </div>
      <div class="ml-auto color-danger cursor-pointer" (click)="selectedListDelete()">Delete</div>
    </div>
    <!--fixed at bottom-->

  </div>

  <div class="genTempGridItem bot-templates position-relative disabled"
       [ngClass]="{'cursor-pointer-event-none':!selectedTemplateKeyInLeftSideBar, 'disabled':!selectedTemplateKeyInLeftSideBar}">
    <div
      style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; max-height: 100%; overflow-y: auto; overflow-x: hidden">

      <div class="text-center mb-2 bot-template-heading">
        <div class="text-bold">Bot Response Template</div>
        <div class="text-lite">Click on elements to add to response</div>
      </div>
      <ul *ngIf="!isTemplateKeyOutputUnparsable(); else templateKeyIsUnparsableMessage">

        <li class="pl-2 bot-template cursor-pointer" (click)="addTextUnit();">
          <i class="fa fa-align-left"></i>Text
        </li>
        <li class="pl-2 bot-template cursor-pointer" (click)="addImageCaraosalUnit()">
          <i class=" fa fa-image"></i>Image corousel
        </li>
        <li class="pl-2 bot-template cursor-pointer" style="opacity: .3; pointer-events: none">
          <i class="fa fa-users"></i>Text Corousel
        </li>
        <li class="pl-2 bot-template cursor-pointer" (click)="addQuickReplyUnit()">
          <i class="fa fa-users"></i>Quick Reply
        </li>
        <li class="pl-2 bot-template cursor-pointer" (click)="addCodeUnit();">
          <i class="fa fa-code"></i>Code Input
        </li>
      </ul>

      <ng-template #templateKeyIsUnparsableMessage>
        <div class="text-center"
             style="font-size: 11px; color: #9e9e9e; position: absolute; top: 50%;right: 0; left: 0">Template
          key output is unparsable
        </div>
      </ng-template>
    </div>
  </div>
</div>
<!--generation template UI ends-->


<ng-template #IntentSelectionModal>
  <div class="primary-modal">
    <div class="top-dec"></div>
    <div class="modal-header" style="border: none !important;">
      <h4 class="modal-title" style="display: flex;justify-content: start;">Copy response templates to</h4>
      <button aria-label="Close" class="close pull-right" type="button" (click)="modalRef.hide()"><span
        aria-hidden="true">×</span>
      </button>
      <br>
    </div>
    <div class="d-flex w-100 col-12" style="align-items: center;padding-left: 27px;">
      <div>{{(modelGenTempNameForm.value|numberOfTrueKeys)||"No"}} response selected</div>
      <div class="cursor-pointer color-primary ml-3" (click)="modelGenTempNameForm.reset()">
        Clear
      </div>
      <div class="cursor-pointer color-primary ml-auto mr-3"
           (click)="selectAllCheckBoxesInCopyTemplateForm(modelGenTempNameForm)">
        Select all
      </div>
      <div>
        <input type="text" style="width: 120px;border: 1px solid #e0e0e0;margin-right: 60px; padding: 3px"
               [(ngModel)]="copyModalTemplateSearchKeyword">
      </div>
    </div>
    <div class="modal-body" style="padding-top: 10px!important;">
      <div class="d-flex flex-column align-items-center justify-content-center m-2" id="checkboxes">

        <form class="modelGridGenTempNames" id="modelGenTempNameForm" #modelGenTempNameForm="ngForm"
              (submit)="selectedListCopy(modelGenTempNameForm)">
          <label class="container-chekbox text-dark"
                 *ngFor="let templateKey of myObject.keys(templateKeyDict)|filterTemplateLeyList:copyModalTemplateSearchKeyword">
            {{templateKey}}
            <input type="checkbox" ngModel name="{{templateKey}}">
            <span class="checkmark"></span>
          </label>
        </form>
        <div class="d-flex w-100">
          <button class="btn-theme btn-theme-primary-outline ml-auto mr-2" (click)="modalRef.hide()">Cancel</button>
          <button class="btn-theme btn-theme-primary  d-inline-block mr-2"
                  [disabled]="(modelGenTempNameForm.value|numberOfTrueKeys)<1"
                  form="modelGenTempNameForm">Copy now
          </button>
        </div>
      </div>
    </div>
  </div>
</ng-template>


<input type="text" hidden #templateKeyToBeDeleted>

<ng-template #EditTemplateKeyModal>
  <div class="primary-modal" (clickOutside)="templateKeyCreationError=''">
    <div class="top-dec"></div>
    <div class="modal-body" style="text-align: left">
      <div class="text-bold">Edit Template key</div>
      <form #templateKeyEditForm="ngForm" class="d-flex align-items-center flex-wrap mt-2">
        <!--<input class="input-material" style="width: 100%" placeholder="Enter template key name" type="text"-->
        <!--[(ngModel)]="newTemplateKey">-->
        <!---->
        <input ngModel name="old_key" hidden type="text" [ngModel]="templateKeyToBeDeleted.value">
        <input ngModel required name="new_key" class="w-100" required type="text" [ngModel]="templateKeyToBeDeleted.value"
               (keyup.enter)="editTemplateKey(templateKeyEditForm)">
        <div class="error-wrapper">
          <span *ngIf="templateKeyCreationError" class="text-danger">{{templateKeyCreationError}}</span>
        </div>
        <div class="d-flex justify-content-end w-100 mt-2">
          <button class="btn-theme btn-theme-primary-outline mr-1" (click)="modalRef.hide()">Cancel</button>
          <button class="btn-theme btn-theme-primary"
                  [disabled]="!templateKeyEditForm.valid"
                  (click)="editTemplateKey(templateKeyEditForm)">Submit
          </button>
        </div>
      </form>
    </div>

  </div>
</ng-template>


<ng-template #IntentModal>
  <div class="primary-modal" (clickOutside)="templateKeyCreationError='';newTemplateKey=''">
    <div class="top-dec"></div>
    <!--<div class="modal-header">-->
    <!--<h4 class="modal-title" style="display: flex;justify-content: start;">Create new template key</h4>-->
    <!--<button aria-label="Close" class="close pull-right" type="button" (click)="modalRef.hide()"><span-->
    <!--aria-hidden="true">×</span>-->
    <!--</button>-->
    <!--</div>-->
    <div class="modal-body" style="text-align: left">
      <div class="text-bold">Create new template key</div>
      <div class="d-flex align-items-center flex-wrap mt-2">
        <input class="input-material" style="width: 100%" placeholder="Enter template key name" type="text"
               (keyup.enter)="createNewTemplatekey()" [(ngModel)]="newTemplateKey">
        <p *ngIf="templateKeyCreationError" class="text-danger">{{templateKeyCreationError}}</p>
        <div class="d-flex justify-content-end w-100 mt-2">
          <button class="btn-theme btn-theme-primary-outline mr-1" (click)="clearNewTemplateKeyData()">Cancel</button>
          <button class="btn-theme btn-theme-primary" [disabled]="!newTemplateKey && newTemplateKey|trimString" (click)="createNewTemplatekey();">
            Create
          </button>
        </div>
      </div>
    </div>

  </div>
</ng-template>

<ng-template #deleteTemplateKeyModal>
  <div class="danger-modal">
    <div class="top-dec"></div>
    <div class="modal-header">
      <h4 class="modal-title mb-2" style="display: flex;justify-content: start;">Delete Template key?</h4>
      <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>

    <div class="modal-body pt-0" style="padding:10px !important;">
      <form #form="ngForm">
        <div class="text-center my-1">
          <p class="mb-3">This action cannot be undone .Are you sure you wish to delete?</p>

        </div>
        <div class="d-flex justify-content-end">
          <button class="btn-theme btn-theme-secondary-outline mr-2" (click)="modalRef.hide()">Cancel</button>
          <button class=" btn-theme btn-theme-danger" (click)="deleteTemplateKey(templateKeyToBeDeleted.value)">Delete
          </button>
        </div>
      </form>
    </div>
  </div>
</ng-template>
