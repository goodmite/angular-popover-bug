<div class="login-section" style="background: white">
  <div
    style="background-image: url('assets/img/login/TriangleL.png'); position: fixed; left: 0;z-index: -1; bottom: 0; width: 25vw; background-position: left; height: 75vh; background-repeat: no-repeat;  background-size: auto 100%;"></div>
  <div class="info-section" style="position: relative; display: flex; justify-content: center; align-content: center">
    <div
      style="background-image: url('assets/img/login/TriangleR.png'); position:absolute; right: 0;z-index: -1; top: 0; width: 25vw; height: 25vw; background-position: top right; background-repeat: no-repeat"></div>
    <div>
      <div class="imi-logo text-center">
        <img src="assets/img/login/imibotlogo.svg" alt="">
      </div>
      <h1 class="hero-heading text-center">
        Build channel-aware contextual  virtual assistants
      </h1>
    </div>
  </div>
  <div class="login-form-section">
    <section *ngIf="panelActive==='login'" class="login-form right">
      <div class="imi-logo">
        <img src="assets/img/login/imibotlogo.svg" alt="">
      </div>
      <main class="right">
        <div class="text">
          <div class="title">Sign in</div>
          <div class="description">
            Welcome back, please login to continue
          </div>
        </div>
        <div class="login-box ">
          <form class="form-theme form-theme-with-md-controls" (ngSubmit)="loginSubmitHandler()" #loginForm="ngForm">
            <input data-cy="login-email" autofocus type="email" required email class="form-theme-control" ngModel
                   name="email" aria-describedby="emailHelp"
                   placeholder="Enter Email">
            <input data-cy="login-password" type="password" class="form-theme-control my-3" name="password" ngModel
                   required
                   placeholder="Enter Password">
            <div class="d-flex justify-content-between align-items-center">
              <a class="cursor-pointer" style="color: #4cd2f1" (click)="panelActive='reset-via-email'">Forgot
                password?</a>
            </div>

            <button mat-flat-button type="submit" class="btn-theme mt-3 mb-2"
                    data-cy="login-submit"
                    [disabled]="disabeLoginButton"
                    [ngClass]="{'btn-theme-primary':!disabeLoginButton, 'btn-theme-disabled':disabeLoginButton}">Sign in
            </button>

            <!--TODO: set form info-->
            <div class="user-info">
              <em class="custom-text-danger"
                  [ngClass]="{'visible':errorMessage}">{{errorMessage}}</em>
              <em class="custom-text-primary" *ngIf="infoMessage"
                  [ngClass]="{'visible':infoMessage}">{{infoMessage}}</em>
            </div>
          </form>
        </div>
      </main>
    </section>

    <!-- reset-via-email starts here -->
    <section *ngIf="panelActive===myELoginPanels['reset-via-email']" class="right">
      <div class="login-box">
        <div class="form-theme form-theme-with-md-controls">
          <div class="col-12 string d-flex">
            <header class="title">Forgot password?</header>
          </div>
          <div class="col-12 mb-3 text-theme-normal" style="color: white; line-height: 14px">
            Please provide your email to send the password reset link to
          </div>
          <div class="col-12">
            <form class="login-form" #emailForPasswordResetForm="ngForm">
              <input type="email" class="form-theme-control" required email ngModel name="email"
                     aria-describedby="emailHelp"
                     placeholder="Enter Email">
              <div style="display: flex; justify-content: space-between; align-items: center">
                <button type="submit" [disabled]="!emailForPasswordResetForm.valid"
                        class="btn-theme btn-theme-primary my-3" (click)="sendEmailForReset()">
                  Request Reset Link
                </button>
                <div class="cursor-pointer" (click)="backToLogin()">Continue to sign in</div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </section>

    <section [hidden]="!(panelActive===myELoginPanels.reset || panelActive===myELoginPanels.set)" class="right" style="width: 100%; max-width: 450px">


      <div class="login-box ">
        <div class="login-form-box">
          <header class="title">{{panelActive === myELoginPanels.reset ? 'Reset' : 'Set'}} password</header>
          <div class="col-12 mb-3 text-theme-normal" style="color: white; line-height: 14px">
            Hello, please enter a new password to continue
          </div>
          <div style="background-color: #9ad4ed; border-radius: 4px; padding: 12px 0; margin-bottom: 12px; color: #474747">
            <ul style="margin-bottom: 0;
    padding-left: 10px;">
              <strong>Password rules</strong>
              <li style="margin-left: 14px;">Between 6 to 16 characters</li>
              <li style="margin-left: 14px;">Must contain at least one number, one uppercase letter and one lowercase letter</li>
              <li style="margin-left: 14px;">Must contain one of these special characters ~!@#$%^&*</li>
            </ul>
          </div>
          <div class="col-12 d-flex justify-content-center align-items-center">
            <form class="login-form w-100" #resetPasswordForm="ngForm">
              <div class="form-group form-theme mb-3">
                <input type="password" required class="form-theme-control" ngModel name="password"
                       aria-describedby="Enter new password"
                       placeholder="Enter new password">
              </div>
              <div class="form-group form-theme">
                <input type="password" required class="form-theme-control" ngModel name="confirm"
                       aria-describedby="Confirm new password"
                       placeholder="Confirm new password">
              </div>
              <div style="display: flex; justify-content: space-between; align-items: center">
                <button type="submit"
                        [disabled]="!resetPasswordForm.valid || resetPasswordForm.value.password !== resetPasswordForm.value.confirm"
                        class="btn-theme btn-theme-primary my-3" (click)="resetPassword()">
                  {{panelActive === myELoginPanels.reset ? 'Reset' : 'Set'}}
                </button>
                <div class="cursor-pointer color-primary" (click)="backToLogin()">Continue to sign in</div>
              </div>

            </form>
          </div>
        </div>
      </div>
    </section>

    <section *ngIf="panelActive==='email-reset-link-notify'" class="right" style="width: 100%">
      <ng-container [ngTemplateOutlet]="passwordChangeSuccess" [ngTemplateOutletContext]="{title:'Email sent', description:'An email has been sent to your email address, consisting of the next steps kindly use the link to reset password'}"></ng-container>
    </section>

    <section *ngIf="panelActive==='password-reset-notify'" class="right">
      <ng-container [ngTemplateOutlet]="passwordChangeSuccess" [ngTemplateOutletContext]="{title:'Password Updated', description:'Your password has been updated successfully, kindly login again to start using your account'}"></ng-container>
    </section>

    <section *ngIf="panelActive==='enterprise-list-display'" style="width: 100%" class="enterprise-flex mx-4 right">
      <div class="d-flex mb-2">
        <div style="font-size: 20px">Select enterprise</div>
        <div class="color-primary cursor-pointer ml-auto" (click)="enterpriseLogout()"><span
          class="fa fa-power-off"> </span>
          Log out
        </div>
      </div>
      <div class="d-flex mb-3">
        <div style="font-size: 16px;">You have {{enterpriseList.length}} enterprises, please select one to proceed</div>
      </div>
      <app-enterprise-list
        [enterpriseList]="enterpriseList"
        [searchEnterprise]="searchEnterprise"
        (clickedEnterprise)="clickedEnterprise($event)"
        [currentEnterpriseId]="-1"></app-enterprise-list>
    </section>
  </div>
</div>


<ng-template #passwordChangeSuccess let-title="title" let-description="description" >
  <div class="forgot-password-container">
    <div style="display: flex; ">
      <div class="title">{{title}}</div>
      <div class="checkmark border-circle" style="flex-shrink: 0">
        <span class="fa fa-check"></span>
      </div>
    </div>
    <div>
      {{description}}
    </div>
    <button class="btn-theme btn-theme-primary my-3" (click)="panelActive='login'">
      Continue to sign in
    </button>
  </div>
</ng-template>
