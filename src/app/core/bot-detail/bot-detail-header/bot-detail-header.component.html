
<div
  class="row-bot-detail-header d-flex align-items-center"
  *ngIf="bot && bot.name"
>
  <div
    class="row-bot-detail-header__back"
    style="text-decoration: none; padding: 0px 8px 0px 16px"
    (click)="goBackToDashboard()"
  >
    <span class="fa fa-angle-left" title="Go to Dashboard"></span>
  </div>
  <img
    class="row-bot-detail-header__bot-logo"
    style="margin:0 8px"
    [defaultImage]="'assets/img/no image.svg'"
    [lazyLoad]="bot.logo"
    alt="Bot logo"
  />
  <div class="row-bot-detail-header__bot-details">
    <div [title]="bot.name.length > 90 ? bot.name : ''" style="display: flex">
      {{ (bot.name | slice: 0:90) + (bot.name.length > 90 ? '...' : '') }}
      <span
        class="fa fa-circle"
        [ngClass]="{
          'dark-green': !bot.bot_disabled_settings?.bot_disabled,
          'dark-orange': bot.bot_disabled_settings?.bot_disabled
        }"
        style="margin-left: 2px; font-size: 6px"
      ></span>
    </div>
    <div style="font-size: 11px">
      <span>Update on </span> {{ bot.updated_at | date: 'd MMM, yy' }} by
      {{ bot.updated_by }}
    </div>
  </div>
  <div class="ml-auto"></div>

  <mat-chip-list
    style="margin-right: 10px"
    aria-label="Disabled label"
    *ngIf="bot?.bot_disabled_settings?.bot_disabled"
  >
    <mat-chip color="accent" selected>Disabled</mat-chip>
  </mat-chip-list>
  <app-integration-channel-list
    class="hide-phone"
    [ngClass]="{ 'greyscale-1': bot?.bot_disabled_settings?.bot_disabled }"
    *ngIf="bot.bot_type != myEBotType.intelligent"
    [bot]="bot"
    style="margin-right: 10px"
  ></app-integration-channel-list>

  <app-faq-search-box
    *ngIf="bot.bot_type == 'faqbot'"
    [bot]="bot"
    [inCuration]="false"
  ></app-faq-search-box>

  <div *appMyIf="myEAllActions['Send API']">

    <ng-container *appMyIf="[myEAllActions['Analytics']]">
      <button
        *ngIf="bot.bot_type !== myEBotType.intelligent"
        (click)="openAnalyticsForBot()"
        class="mat-theme-button mat-theme-button-border"
        mat-button
      >
        <mat-icon>trending_up</mat-icon>
        Analytics
      </button>
    </ng-container>

    <button
      class="mat-theme-button mat-theme-button-border hide-phone"
      (click)="previewBot()"
      *ngIf="bot.bot_type != myEBotType.intelligent"
      mat-button
    >
      <mat-icon>chat_bubble_outline</mat-icon>
      Preview
    </button>
  </div>

  <button
    mat-icon-button
    [matMenuTriggerFor]="appMenu"
    class="click-save-wrapper"
    data-cy="3-bot-button-on-top"
  >
    <mat-icon>more_vert</mat-icon>
  </button>

  <mat-menu class="cutom-md-menu" #appMenu="matMenu">
    <button *ngIf="bot.bot_type !== myEBotType.intelligent" mat-menu-item (click)="copySharablePreviewLinkHandler()">
      <span class="fa fa-share mr-1"></span>Copy Preview Link
    </button>
    <button
      mat-menu-item
      (click)="utilityService.copyToClipboard(ServerService.getBotTokenById(this.bot.id))"
    >
      <mat-icon class="mat-icon material-icons mr-1">file_copy</mat-icon>
      Copy Access Token
    </button>
    <button
      mat-menu-item
      (click)="utilityService.copyToClipboard(bot.enterprise_id)"
    >
      <mat-icon class="mat-icon material-icons mr-1">file_copy</mat-icon>
      Copy
      Enterprise ID
    </button>
    <button
      mat-menu-item
      *appMyIf="[myEAllActions['Delete Bots']]"
      (click)="openDeleteModal()"
    >
      <mat-icon class="mat-icon material-icons mr-1">delete</mat-icon>
      Delete
    </button>
  </mat-menu>
</div>

<ng-template #template>
  <div class="danger-modal center-modal">
    <div class="top-dec"></div>
    <div class="modal-header">
      <h4
        class="modal-title mb-2"
        style="display: flex;justify-content: start;"
      >
        Delete bot&nbsp;{{ bot.name }}&nbsp; ?
      </h4>
      <button
        type="button"
        class="close pull-right"
        aria-label="Close"
        (click)="dialogRefWrapper.ref.close()"
      >
        <span aria-hidden="true">&times;</span>
      </button>
    </div>

    <div class="modal-body pt-0">
      <form #form="ngForm">
        <div class="text-center my-1">
          <p class="mb-3">
            This action cannot be undone. Are you sure you wish to delete?
          </p>
        </div>
        <button
          class="btn-theme btn-theme-secondary-outline mr-2"
          (click)="dialogRefWrapper.ref.close()"
        >
          Cancel
        </button>
        <button class=" btn-theme btn-theme-danger" (click)="deleteBot()">
          Delete
        </button>
      </form>
    </div>
  </div>
</ng-template>

<ng-template #activeVersionChangedTemplate>
  <div class="danger-modal">
    <div class="top-dec"></div>
    <div class="modal-header">
      <h4
        class="modal-title mb-2"
        style="display: flex;justify-content: start;"
      >
        Active version changed
      </h4>
      <button
        type="button"
        class="close pull-right"
        aria-label="Close"
        (click)="dialogRefWrapper.ref.close()"
      >
        <span aria-hidden="true">&times;</span>
      </button>
    </div>

    <div class="modal-body pt-0">
      <form #form="ngForm">
        <div class="text-center my-1">
          <p class="mb-3">
            If you update the bot your currently selected version will be the
            new Active version.
          </p>
        </div>
        <button
          class="btn-theme btn-theme-secondary-outline mr-2"
          (click)="dialogRefWrapper.ref.close()"
        >
          Cancel
        </button>
        <button class=" btn-theme btn-theme-danger" (click)="updateBot()">
          Update
        </button>
      </form>
    </div>
  </div>
</ng-template>
