<section class="bot-session-section fade-in-custom">
  <form *ngIf="filterForm" [hidden]="!showFilterForm" [formGroup]="filterForm" class="refine-results hide-phone">
    <strong>Refine Results</strong>
    <hr class="refine-results__divider">
    <mat-form-field>
      <input matInput placeholder="Room Id"
             type="number"
             formControlName="id">
      <mat-error class="mat-error-small"
                 *ngIf="filterForm.get('id').errors?.error as errorObj">{{errorObj.message}}</mat-error>
    </mat-form-field>
    <mat-form-field class="">
      <input matInput placeholder="Consumer Id"
             type="number"
             formControlName="consumer_id">
      <mat-error class="mat-error-small"
                 *ngIf="filterForm.get('consumer_id').errors?.error as errorObj">{{errorObj.message}}</mat-error>
    </mat-form-field>

    <div class="refine-results__length">
      <div>Messages</div>
      <div class="input-container">
        <mat-form-field class="input-no-label" floatLabel="never">
          <input matInput placeholder="min" type="number"
                 formControlName="total_message_count__gte">
        </mat-form-field>
        <span>to</span>
        <mat-form-field class="input-no-label" floatLabel="never">
          <input matInput placeholder="max" type="number"
                 formControlName="total_message_count__lte">
        </mat-form-field>
      </div>
      <div *ngIf="filterForm.get('total_message_count__gte').errors?.error || filterForm.get('total_message_count__lte').errors?.error as errorObj">
        <mat-error class="mat-error-small">{{errorObj.message}}</mat-error>
      </div>
    </div>
    <div class="refine-results__channel">
      <div>Channels</div>
      <ul formArrayName="channels">
        <li *ngFor="let channel of channels; let index = index" formGroupName="{{index}}">
          <mat-checkbox *ngIf="channel.integration_type=== 'channels'" color="primary"
                        formControlName="{{channel.key}}" [title]="channel.unique_name">
            <img alt="channel icon" [src]="channel.icon" [alt]="channel.unique_name">
          </mat-checkbox>
        </li>
      </ul>
    </div>

    <mat-form-field floatLabel="never">
      <input matInput
             formControlName="updated_at"
             readonly
             placeholder="Last Updated"
             style="pointer-events: none"
             [satDatepicker]="picker">
      <sat-datepicker #picker [rangeMode]="true"></sat-datepicker>
      <sat-datepicker-toggle matSuffix [for]="picker"></sat-datepicker-toggle>
    </mat-form-field>

    <ul>Room metadata
      <li>
        <mat-checkbox formControlName="is_live" color="primary">Hide test sessions</mat-checkbox>
      </li>
      <li>
        <mat-checkbox formControlName="sendtoagent" color="primary">Agent handover happened</mat-checkbox>
      </li>
      <li>
        <mat-checkbox formControlName="error" color="primary">Error occurred</mat-checkbox>
      </li>
      <li>
        <mat-checkbox formControlName="downvote" color="primary">Downvoted</mat-checkbox>
      </li>
    </ul>

    <div class="refine-results__action">
      <button mat-flat-button class="mat-theme-button"
              color="primary" type="submit" (click)="sessionFormSubmitted(filterForm.value)">Submit
      </button>
      <button mat-button class="mat-theme-button cancel"
              type="button"
              (click)="resetSearchForm(filterForm)">Clear
      </button>
    </div>
  </form>

  <app-smart-table
    *ngIf="sessionsSmartTableDataModal.tableData as tableData"
    [data]="tableData"
    [totalRecords]="totalSessionRecords"
    [currentPage]="pageNumberOfCurrentRowSelected"
    noResultsMessage="No sessions found. Search again."
    (customActionEvents)="customActionEventsTriggeredInSessionsTable($event)"
    (rowClicked$)="sessionTableRowClicked($event, sessionDetailTemplate)"
    [showSearchInDbButton]="true"
    [showRefreshButton]="true"
    (refreshData$)="performSearchInDbForSessionHandler($event)"
    (performSearchInDB$)="performSearchInDbForSessionHandler($event)">
    <!--ng-content starts-->
    <div *ngIf="bot.advanced_data_protection && !showLoader && !showSplashScreen"
         style="border: 1px solid #e0e0e0; align-self: flex-end;padding: 0px 10px;margin-left: 10px;">
      <span class="fa fa-lock" style="color: orange"></span>
      All the sessions are encrypted, use the decryption key to view individual session of interest
    </div>
    <!--ng-content ends-->
  </app-smart-table>
</section>


<app-splash-screen *ngIf="showSplashScreen && !showLoader"
                   [imageHRef]="myESplashScreens.sessions"
                   [headingText]="'No sessions found'"
                   [descriptionText]="'Integrate or deploy your bot to see all conversations bot was involved in'"
                   class="d-flex justify-content-center align-items-center"
></app-splash-screen>

<app-imi-loader *ngIf="showLoader "></app-imi-loader>


<ng-template #sessionDetailTemplate>
  <app-session-detail-model
    [session]="selectedRow_Session"
    [bot]="bot"
    (selectNextRow)="selectNextRow()"
    (closeModel$)="dialogRefWrapper.ref.close()"
    (selectPrevRow)="selectPrevRow()"
    [pageNumberOfCurrentRowSelected]="pageNumberOfCurrentRowSelected"
    [indexOfCurrentRowSelected]="indexOfCurrentRowSelected"
    [finalDfState]="selectedRow_Session.df_state"
    (refreshSession$)="updateSessionById($event)"
    [sessionDataStore]="selectedRow_Session.data_store">
  </app-session-detail-model>
</ng-template>
