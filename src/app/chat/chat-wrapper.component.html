<!--chat box started-->
<div *ngIf="!isFullScreenPreview && currentBot">
  <div class="chat-grid text-center" *ngIf="(windowOpen && (loggeduser$|async).user)">
    <div class="chat-grid__header">
              <span [matTooltip]="'Go to room list'" (click)="navigate(myEChatFrame.CHAT_LIST)"
                    [hidden]="frameEnabled===myEChatFrame.CHAT_LIST">
                <i data-cy="chat-back" class="fa fa-angle-left"></i>
              </span>

      <!--TODO: when clicked open the bot-->
      <!--<a [matTooltip]="'Open '+ chatWindowTitle" [routerLink]="['/core/botdetail/chatbot/', currentBot.id]">-->
      <!--<img [src]="currentBot.logo" class="chat-logo" alt="Bot logo">-->
      <!--{{(chatWindowTitle| slice:0: 22) + (chatWindowTitle.length > 22 ? "..." : "")}}</a>-->
      <a>
        <img
          [defaultImage]="'assets/img/no image.svg'"
          [lazyLoad]="currentBot.logo"
          class="chat-logo" alt="Bot logo">
        {{(chatWindowTitle| slice:0: 22) + (chatWindowTitle.length > 22 ? "..." : "")}}</a>
      <a class="ml-auto hover-parent"
         data-cy="chat-full-screen"
         [routerLink]="['/preview']"
         [queryParams]="{bot_unique_name:currentBot.bot_unique_name,enterprise_unique_name:enterprise_unique_name}"
         [matTooltip]="'Open in new Tab'"
         target="_blank">
        <button mat-icon-button
                [class.active]="showOverlay">
          <mat-icon>tab</mat-icon>
        </button>
      </a>

      <!--consumer dropdown starts-->
      <button mat-icon-button (click)="showOverlay = true"
              [class.active]="showOverlay" class="origin"
              #overlayOrigin="cdkOverlayOrigin"
              data-cy="custom-room-form-trigger"
              [matTooltip]="'New chat with custom data'"
              cdkOverlayOrigin>
        <mat-icon>{{frameEnabled === myEChatFrame.CHAT_LIST ? 'person_add' : 'perm_contact_calendar'}}</mat-icon>
      </button>
      <ng-container
        [ngTemplateOutlet]="validationTemplate"
        [ngTemplateOutletContext]="{
          overlayOrigin: overlayOrigin,
          customConsumerDetails:frameEnabled === myEChatFrame.CHAT_BOX? currentRoom.consumerDetails:{},
          createNewRoom: frameEnabled === myEChatFrame.CHAT_LIST,
          showOverlay: showOverlay
        }">
      </ng-container>

      <button mat-icon-button
              data-cy="chat-minimize"
              (click)="closeChatWindow()"
              [matTooltip]="'Minimize'"
              [class.active]="showOverlay" class="origin">
        <mat-icon>minimize</mat-icon>
      </button>

    </div>
    <div class="body p-0 border-left border-right"
         [ngClass]="{'make-body-occupy-footer':frameEnabled!==myEChatFrame.CHAT_BOX}">
      <app-bot-welcome
        [currentBot]="currentBot"
        (startnewchat$)="startNewChat($event)" [bot_id]="welcomeScreenBotId"
        *ngIf="frameEnabled === myEChatFrame.WELCOME_BOX"></app-bot-welcome>
      <app-chat-list class="mt-4"
                     [currentBot]="currentBot"
                     *ngIf="frameEnabled===myEChatFrame.CHAT_LIST"
                     (createCustomRoom$)="createCustomRoom()"
                     (createNewRoom$)="startNewChat($event)"
      ></app-chat-list>
      <app-chat-window *ngIf="frameEnabled===myEChatFrame.CHAT_BOX && this.messageData"
                       [allow_feedback]="currentBot.allow_feedback"
                       [selectedAvatar]="selectedAvatar"
                       [room]="currentRoom"
                       [bot]="currentBot"
                       [showBotIsThinking]="showBotIsThinking"
                       (sendMessageByHuman$)="sendMessageByHuman($event)"
                       (chatMessageFeedback$)="sendFeedback($event)"
                       [messageDataArray]="messageData">
      </app-chat-window>
    </div>
  </div>

</div>
<!--chat box ends-->

<!--tool tip starts-->
<div class="preview-tooltip" data-cy="preview-tooltip" (click)="toggleChatWindow()" *ngIf="!windowOpen && currentBot">
  <img
    [defaultImage]="'assets/img/no image.svg'"
    [lazyLoad]="currentBot.logo" alt="">
</div>
<!--tool tip ends-->

<!--===============FULL SCREEN BELOW===================-->
<div *ngIf="isFullScreenPreview" class="grid-chat-preview-full-screen">
  <div class="header1 px-3 d-flex align-items-center">
    <img class="logo-md mr-2 rounded-circle"
         data-cy="chat-logo-enterprise"
         [defaultImage]="'assets/img/no image.svg'"
         [lazyLoad]="enterprise_logo"
         style="border-radius: 50%;">
    <div class="d-flex flex-column text-white">
      <div>{{user_first_name}}</div>
      <div class="font-11">{{user_email}}</div>
    </div>

    <button mat-icon-button (click)="showOverlay = true"
            style="margin-left: auto"
            [class.active]="showOverlay" class="origin"
            #overlayOriginFullScreen1="cdkOverlayOrigin"
            data-cy="custom-room-form-trigger"
            [matTooltip]="'New chat with custom data'"
            cdkOverlayOrigin>
      <mat-icon>person_add</mat-icon>
    </button>
    <ng-container
      [ngTemplateOutlet]="validationTemplate"
      [ngTemplateOutletContext]="{
          overlayOrigin: overlayOriginFullScreen1,
          customConsumerDetails:{},
          createNewRoom: true,
          showOverlay: showOverlay
        }">
    </ng-container>

    <!--<button mat-icon-button (click)="showOverlay_edit_fullscreen = true"-->
            <!--data-cy="custom-room-form-trigger"-->
            <!--[class.active]="showOverlay_edit_fullscreen" class="ml-auto"-->
            <!--#overlayOriginFullScreen1="cdkOverlayOrigin"-->
            <!--cdkOverlayOrigin>-->
      <!--<mat-icon>perm_contact_calendar</mat-icon>-->
    <!--</button>-->

    <!--<app-overlay-->
      <!--[overlayOrigin]="overlayOriginFullScreen1"-->
      <!--[showOverlay]="showOverlay_edit_fullscreen"-->
      <!--[overlayClass]="'bg-transparent'"-->
      <!--(backdropClick$)="showOverlay_edit_fullscreen = false">-->
      <!--<div class="dialog-container">-->
        <!--<app-chat-consumer-form-->
          <!--*ngIf="showOverlay_edit_fullscreen"-->
          <!--[customConsumerDetails]="{}"-->
          <!--(hideOverlay$)="showOverlay_edit_fullscreen = false"-->
          <!--(saveConsumerDetails$)="startNewChat({consumerDetails: $event, bot:currentBot, isCustomRoom:true})"></app-chat-consumer-form>-->
      <!--</div>-->
    <!--</app-overlay>-->


    <!--<div class="btn-group p-2 ml-auto" #dropdown="bs-dropdown" [autoClose]="false" dropdown-->
    <!--<div dropdownToggle class="user cursor-pointer text-white"><i class="fa fa-user"></i></div>-->


    <!--<form *dropdownMenu class="dropdown-menu dropdown-menu-left p-3" role="menu" #form="ngForm"-->
    <!--(ngSubmit)="saveConsumerDetails(form.value)"-->
    <!--style="width: 240px">-->
    <!--<p class="heading mb-2">Edit Customer</p>-->
    <!--<div class="form-group">-->
    <!--<label>Name</label>-->
    <!--<input type="text" required email class="form-control" [ngModel]="customConsumerDetails?.name"-->
    <!--name="name" aria-describedby="emailHelp">-->
    <!--</div>-->
    <!--<div class="form-group">-->
    <!--<label>Phone</label>-->
    <!--<input type="text" required email class="form-control" [ngModel]="customConsumerDetails?.phone" name="phone"-->
    <!--aria-describedby="emailHelp">-->
    <!--</div>-->
    <!--<div class="form-group">-->
    <!--<label>Email</label>-->
    <!--<input type="email" required email class="form-control" [ngModel]="customConsumerDetails?.email" name="email"-->
    <!--aria-describedby="emailHelp">-->
    <!--</div>-->
    <!--<div class="form-group">-->
    <!--<label>Facebook ID</label>-->
    <!--<input type="text" required email class="form-control" [ngModel]="customConsumerDetails?.facebook_id"-->
    <!--name="facebook_id" aria-describedby="emailHelp">-->
    <!--</div>-->
    <!--<div class="form-group">-->
    <!--<label>UID</label>-->
    <!--<input type="text" required email class="form-control" [ngModel]="customConsumerDetails?.uid" name="uid"-->
    <!--aria-describedby="emailHelp">-->
    <!--</div>-->
    <!--<button type="submit" class="btn-block btn-theme-primary my-3" (click)="dropdown.hide()">Save Changes</button>-->
    <!--</form>-->
    <!--</div>-->

  </div>
  <div class="header2 px-3 bg-theme-primary d-flex align-items-center">
    <!--<img class="logo-md" src="https://image.flaticon.com/icons/svg/17/17004.svg" alt="">-->
    <img *ngIf="currentBot" class="logo-md mr-2 rounded-circle"
         data-cy="chat-logo-bot"
         [defaultImage]="'assets/img/no image.svg'"
         [lazyLoad]="currentBot.logo||'https://image.flaticon.com/icons/svg/17/17004.svg'">
    <div *ngIf="currentBot" class="d-flex flex-column text-white">
      <div>{{currentBot.name}}</div>
      <!--<div class="font-11">{{bot.description}}</div>-->
    </div>
    <!---->
    <!--<div class="room-details ml-auto">-->
    <!--<div *ngIf="currentRoom" [style.visibility]="currentRoom.roomId?'visible':'hidden'"-->
    <!--class="d-flex flex-column align-items-end ml-auto mr-4 text-white">-->
    <!--<div>Room ID:</div>-->
    <!--<div class="font-11">{{currentRoom.roomId}}</div>-->
    <!--</div>-->
    <div class="ml-auto"></div>
    <div *ngIf="currentRoom && currentRoom.lastTemplateKey"
         class="d-flex mr-3 flex-column align-items-end text-white">
      <div>Last template:</div>
      <div class="font-11" data-cy="chat-room-lasttemplaykey">{{currentRoom.lastTemplateKey}}</div>
    </div>

    <button mat-icon-button (click)="showOverlay_edit_fullscreen = true"
            [class.active]="showOverlay" class="origin"
            #overlayOrigin="cdkOverlayOrigin"
            data-cy="custom-room-form-trigger"
            [matTooltip]="'Consumer info'"
            cdkOverlayOrigin>
      <mat-icon>perm_contact_calendar</mat-icon>
    </button>
    <ng-container
      [ngTemplateOutlet]="validationTemplate"
      [ngTemplateOutletContext]="{
          overlayOrigin: overlayOrigin,
          customConsumerDetails:currentRoom.consumerDetails,
          createNewRoom: false,
          showOverlay: showOverlay_edit_fullscreen
        }">
    </ng-container>

    <!--<app-overlay-->
      <!--[overlayOrigin]="overlayOrigin"-->
      <!--[showOverlay]="showOverlay"-->
      <!--(backdropClick$)="showOverlay = false"-->
      <!--[overlayClass]="'bg-transparent'">-->
      <!--<div class="dialog-container">-->
        <!--<app-chat-consumer-form-->
          <!--*ngIf="showOverlay"-->
          <!--[customConsumerDetails]="frameEnabled === myEChatFrame.CHAT_BOX? currentRoom.consumerDetails:{}"-->
          <!--(hideOverlay$)="showOverlay = false"-->
          <!--[readonly]="frameEnabled === myEChatFrame.CHAT_BOX"-->
          <!--(saveConsumerDetails$)="saveConsumerDetails($event)"></app-chat-consumer-form>-->
      <!--</div>-->
    <!--</app-overlay>-->
    <!--<div *ngIf="currentRoom && currentRoom.uid" class="d-flex  flex-column align-items-end text-white">-->
    <!--<div>Room UID:</div>-->
    <!--<div class="font-11" data-cy="chat-room-uid">{{currentRoom.uid}}</div>-->
    <!--</div>-->
  </div>
  <div class="chat-rooms" style="overflow: hidden">
    <!--<app-chat-list class="mt-4"-->
    <!--(createCustomRoom$)="createCustomRoom()"-->
    <!--[currentBot]="currentBot"-->
    <!--(createNewRoom$)="startNewChat($event)"></app-chat-list>-->
    <app-chat-list class="mt-4"
                   [currentBot]="currentBot"
                   (createCustomRoom$)="createCustomRoom()"
                   (createNewRoom$)="startNewChat($event)"
    ></app-chat-list>
  </div>
  <div class="chat">
    <!--<app-chat-window-->
    <!--[selectedAvatar]="selectedAvatar"-->
    <!--[showBotIsThinking]="showBotIsThinking"-->
    <!--[room]="currentRoom"-->
    <!--[allow_feedback]="currentBot.allow_feedback"-->
    <!--(sendMessageByHuman$)="sendMessageByHuman($event)"-->
    <!--(chatMessageFeedback$)="sendFeedback($event)"-->
    <!--[messageDataArray]="messageData">-->
    <!--</app-chat-window>-->

    <app-chat-window *ngIf="frameEnabled===myEChatFrame.CHAT_BOX && this.messageData"
                     [allow_feedback]="currentBot.allow_feedback"
                     [selectedAvatar]="selectedAvatar"
                     [room]="currentRoom"
                     [bot]="currentBot"
                     [showBotIsThinking]="showBotIsThinking"
                     (sendMessageByHuman$)="sendMessageByHuman($event)"
                     (chatMessageFeedback$)="sendFeedback($event)"
                     [messageDataArray]="messageData">
    </app-chat-window>
  </div>
</div>


<ng-template #validationTemplate
             let-overlayOrigin="overlayOrigin"
             let-customConsumerDetails="customConsumerDetails"
             let-showOverlay="showOverlay"
             let-createNewRoom="createNewRoom">
  <app-overlay
    [overlayOrigin]="overlayOrigin"
    [showOverlay]="showOverlay"
    (backdropClick$)="hideOverlay()"
    [overlayClass]="'bg-transparent'">
    <div class="dialog-container">
      <app-chat-consumer-form
        *ngIf="showOverlay"
        [customConsumerDetails]="customConsumerDetails"
        [title]="'Edit room consumer'"
        (hideOverlay$)="hideOverlay()"
        [readonly]="!createNewRoom"
        (saveConsumerDetails$)="consumerFormSubmitHandler($event, createNewRoom)"></app-chat-consumer-form>
    </div>
  </app-overlay>
</ng-template>