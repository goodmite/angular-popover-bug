<section class="session-modal-section">
  <div class="session-modal-section__header">
    <div class="session-modal-section__header--img">
      <img alt="channel name"
           [defaultImage]="'assets/img/no image.svg'"
           [lazyLoad]='channelNameToImg(sessionMessageData && sessionMessageData[0]?.platform)'>
    </div>
    <div class="session-modal-section__header--item">
      <div class="secondary">Room ID:</div>
      <div class="primary16 ">{{_session.id}}</div>
    </div>
    <div class="session-modal-section__header--item">
      <div class="secondary">Consumer ID:</div>
      <div class="primary16 ">{{_session.consumer_id}}</div>
    </div>
    <div class="session-modal-section__header--item">
      <span class="secondary">Total Messages</span>
      <span class="primary16">{{sessionMessageData?.length}}</span>
    </div>
    <div class="session-modal-section__header--item">
      <div class="secondary">Last updated at</div>
      <div class="primary d-flex ">
        {{_session.updated_at | date:"MMM d"}}&nbsp;'{{_session.updated_at | date:"yy"}}&nbsp;{{_session.updated_at | date:"shortTime"}}
        <mat-icon class="material-icons cursor-pointer ml-1" style = "font-size: 16px;"(click)="updateModal(_session.id);">refresh</mat-icon>
      </div>
    </div>

    <div (click)="closeModel$.emit()" class="ml-auto"><span class="fa fa-times cursor-pointer"></span></div>
  </div>
  <div class="session-modal-section__body ">

    <div class="session-modal-section__body--convo">
      <!--search input starts-->
      <div class="d-flex" style="align-items: center;">
        <mat-form-field class="ml-3">
          <input matInput ngModel
            (ngModelChange)="scrollToFirstKeywordMatch($event)"
            (keyup.enter)="goToNextSearchResult(messageSearchKeyword)"
            (keyup.shift.enter)="goToPreviousSearchResult(messageSearchKeyword)"
            id="search-session-model"
            type="search"
            placeholder="search">
          <mat-icon matSuffix style="color : #070707; font-size: 16px;">search</mat-icon>
        </mat-form-field>
        <mat-icon class= "search-error ml-3" *ngIf="_session.error">error_outline</mat-icon>
        <mat-icon class= "search-agent ml-3" *ngIf="_session.sendtoagent">headset_mic</mat-icon>
        <div class="found-result" *ngIf="messageSearchKeyword && (messageTextSearchLength > 0)">{{searchEnterPressedCount+1}}/{{messageTextSearchLength}}
          messages found
          <span class="fa fa-angle-up mx-1" (click)="goToPreviousSearchResult(messageSearchKeyword)"></span>
          <span class="fa fa-angle-down mx-1" (click)="goToNextSearchResult(messageSearchKeyword)"></span>
        </div>
        <div class="found-result" *ngIf="messageSearchKeyword && !(messageTextSearchLength > 0)">
           No messages found
          </div>
      </div>

      <div class="session-messages-container row m-0 my-2 p-1 align-items-start align-content-start">
        <span class="fa" [ngClass]="{'fa-angle-down':scrollDown,'fa-angle-up':!scrollDown}"
          *ngIf="sessionMessageDataCopy && sessionMessageDataCopy.length >5" (click)="scrollMessageList()"></span>
        <div style="height: 100%;width: 100%; padding-right: 5px" class="session-messages-container-list">
          <div class="col-12 px-0 border-hover-txn" style="padding-left: 5px !important;"
               *ngFor="let txnConversationItems of sessionMessageDataCopy|serializeSessionMessage|highlightSessionTexts:messageSearchKeyword; let i=index; trackBy:trackByIndex"
            [ngClass]="{'border-selected-txn':txnConversationItems.transaction_id === transactionIdSelectedInModel,
'border-unselected-txn':txnConversationItems.transaction_id !== transactionIdSelectedInModel}">

            <app-session-message [txnConversationItems]="txnConversationItems"
            [bot]="bot"
            (messageClickedEvent$)="transactionIdChangedInModel($event)"></app-session-message>
          </div>
        </div>
        <div *ngIf="!sessionMessageDataCopy || sessionMessageData.length===0"
          style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; "
          class="col-12 align-self-stretch d-flex justify-content-center align-items-center">
          <p class="text-muted">No Messages to show</p>
        </div>
      </div>
    </div>

    <div class="session-modal-section__body--metadata ">
      <!--todo: get back to this code after removing bootstrap-->
      <ul class="nav nav-tabs my-2 pb-0">
        <li class="nav-item px-0">
          <a class="nav-link p-0 mr-2" [ngClass]="{'tab-active':activeTab==='manager_bot'}"
            (click)="tabClicked('manager_bot')"><strong>TRANSACTION INFO</strong></a>
        </li>
        <li class="nav-item mr-2">
          <a class="nav-link p-0" [ngClass]="{'tab-active':activeTab==='active_bot'}" (click)="tabClicked('active_bot')"
            *ngIf="bot.is_manager"><strong>ACTIVE BOT</strong></a>
        </li>
        <li class="nav-item" *ngIf="bot.bot_type == 'chatbot'">
          <a class="nav-link p-0" [ngClass]="{'tab-active':activeTab==='nlp'}"
            (click)="tabClicked('nlp')"><strong>NLP</strong></a>
        </li>
        <li class="nav-item ml-auto" *ngIf="bot.bot_type == 'chatbot'">
          <a class="nav-link p-0 mr-2" [ngClass]="{'tab-active':activeTab==='final_df'}"
            (click)="tabClicked('final_df')"><strong>FINAL DF</strong></a>
        </li>
        <li class="nav-item" *ngIf="bot.bot_type == 'chatbot'">
          <a class="nav-link p-0 mr-2" [ngClass]="{'tab-active':activeTab==='datastore'}"
            (click)="tabClicked('datastore')"><strong>DATASTORE</strong></a>
        </li>
      </ul>
      <div *ngIf="!codeText" class="editor-container" style="width: 100%; height: 100%;">
        <span class="fa fa-arrow-left" style="font-size: 15px; color: #9e9e9e"></span>
        <em style="color: #9e9e9e;">Select a transaction to
          see metadata associated</em>
      </div>
      <app-code-editor *ngIf="codeText" class="child-expand" [text]="{ text: codeText|json}"></app-code-editor>
    </div>
  </div>
</section>
