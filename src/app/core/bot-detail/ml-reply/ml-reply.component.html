<header>
  <div class="d-flex flex-row heading" style="height: 32px">
    <strong class="heading-title">
      Responses
    </strong>
    <ng-template #blinking>
      <div class="article-state blinking">
        <i class="fa fa-circle blinking" style="color: white; font-size: 6px; margin-right: 4px"></i>
        <i class="fa fa-circle blinking" style="color: white; font-size: 6px; margin-right: 4px"></i>
        <i class="fa fa-circle blinking" style="color: white; font-size: 6px;"></i>
      </div>
    </ng-template>
    <div class="article-state " *ngIf="mlResponse && mlResponse.state as state; else blinking"
         [ngStyle]="{'background-color':  (mlResponse.state === 'saved' || mlResponse.state ===  'cloned') ? '#fdc31c':
          state === 'training' ? '#f48a42' :
          state === 'trained' ? '#00abd3' :
          state === 'live' ? '#34bc6e' : '#00abd3', 'color': (state === 'saved' || mlResponse.state ===  'cloned') ? '#474747' : '#ffffff' }">
      {{ (state === 'saved' || mlResponse.state ===  'cloned')? 'Saved' :
        state === 'training' ? 'Training' :
            state === 'trained' ? 'Trained' :
                state === 'live' ? 'Live' : 'Trained' }}
    </div>
    <div class="mr-auto">
    </div>
    <div style="display: flex" *ngIf="mlResponse?.state !== 'live'">
      <button (click)="openMakeLiveCorpusModal(makeLiveModelTemplate)"
              style="padding: 0 10px 0 8px !important;" *appMyIf="myEAllActions['Make responses live']"
              class="btn-theme btn-theme-primary mat-theme-button mr-1">
        <mat-icon class="mat-icon material-icons">arrow_upward</mat-icon>
        Make live
      </button>

      <app-button-wrapper
        class="card--update"
        [icon]="'edit'"
        [isMatFlatButton]="false"
        [text]="'Discard draft'"
        (btnClick)="loadFromLive()">
      </app-button-wrapper>
    </div>
  </div>
  <div style="color: #696969;font-size: 11px;">
    Configure the responses for the recognized intents and entities to complete user flow
  </div>
</header>

<div style="position: relative; min-height: 80vh">
  <app-imi-loader class="loader-center" *ngIf="showLoading"></app-imi-loader>
  <app-button-wrapper
    style="position: absolute;
    right: 0;
    top: 23px;
    z-index: 10;" *appMyIf="myEAllActions['Make responses live']"
    class="card--update"
    [icon]="'refresh'"
    [isMatFlatButton]="false"
    [text]="'Update'"
    (btnClick)="updateResponse()">
  </app-button-wrapper>

  <mat-tab-group (selectedTabChange)="tabChanged($event)" *ngIf="!showLoading">
    <mat-tab label="Templates">
      <app-code-gentemplate-ui-wrapper
        style="flex-grow: 1; min-height: 60vh"
        class="row mx-0 px-0 child-expand ml-bot-reply"
        [bot]="bot"
        [templateKeyDict]="templateKeyDict"
        [headingAsSelectedTemplateKey]="true"
        [hideChannelDropdown]="true"
        [showModeSelect]="true"
        [response]="mlResponse"
        (modeChanged$)="log($event)"
        [defaultTemplateKeys]="mlResponse?.default_templates"
        [channelList]="[]"
      >
      </app-code-gentemplate-ui-wrapper>
    </mat-tab>
    <mat-tab label="Workflows" class="no-over-flow h-100">
      <app-code-editor
        style="height: 500px"
        class="code-editor"
        [text]="workFlowObj"
        [doShowValidationsIcon]="false"
        [doShowUploadDownloadButton]="false"
      ></app-code-editor>
    </mat-tab>
  </mat-tab-group>
</div>

<ng-template #makeLiveModelTemplate>
  <div class="primary-modal" style="width: 37vw;">
    <div class="modal-header">
      <h4 class="modal-title mb-2" style="display: flex;justify-content: start;font-size: 16px;">
        Make Live
      </h4>
      <button type="button" class="close pull-right" aria-label="Close" (click)="dialogRefWrapper.ref.close()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>

    <div class="modal-body pt-0 ">
      <div class="pb-2">
        <div>We have detected trained changes in your model, would you want to make them live as well?</div>
      </div>
      <div class = "d-flex">
        <button class="btn-theme btn-theme-secondary-outline ml-auto mr-2 px-15"
                (click)="makeLiveCorpus()">Only responses</button>
        <button class="btn-theme btn-theme-primary mat-theme-button mat-theme-button-border cursor-pointer  mr-2 px-15"
                [disabled]="corpusMiniObj['state'] != 'trained'"
                (click)="makeBothCorpusLive()">Make live both</button>
      </div>

    </div>
  </div>
</ng-template>
