
<section class="wrapper cursor-pointer position-relative" (click)="navigateToBotDetailPage($event)">
  <div class="grid-bot-preview-two bg-white shadow-theme">
    <div class="header-border-bottom"></div><!--just for border-->
    <!--header starts-->
    <header class="grid-bot-preview-version header header-border-bottom d-flex">
      <div class="span-wrapper" *ngIf="bot.bot_type === 'chatbot'">
        <i class="fa fa-circle"></i>
      </div>
      <div class="ml-1 " style="align-self: center" *ngIf="bot.bot_type === 'chatbot'">
        Active(v{{bot.active_version.version || 0}})
      </div>
      <div class="ml-auto" style="align-self: center">
        <div class=" show-on-parent-hover" style="align-self: center" *ngIf="bot.bot_type === 'chatbot'">
          Latest(v{{bot.latest_version.version || 0}})
        </div>
        <i *ngIf="bot.store_isPinned" class="fa p-1 fa-thumb-tack" (click)="togglePinBotCard(bot, false)"></i>
        <div class="btn-group" dropdown style="align-self: center; font-size: 18px;padding:0;">

          <button mat-icon-button [matMenuTriggerFor]="appMenu" class="click-save-wrapper">
            <mat-icon class="click-save-wrapper">more_vert</mat-icon>
          </button>

        </div>
      </div>
    </header>
    <!--header ends-->
    <div></div><!--just for border-->

    <figure class="ml-2 grid-bot-preview-img grid-bot-preview-second-row main-logo-wrapper">
      <img class="logo-md rounded-circle" [src]="bot.logo" alt="">
    </figure>
    <div class="grid-bot-preview-name details1 text-theme-secondary">
      <h6 class="heading">{{(bot.name|slice:0:36)+(bot.name.length>36?"...":"")}}</h6>
      <p class="description mt-1">{{bot.description}}</p>
    </div>
    <div class="grid-bot-preview-details grid-bot-preview-third-row details2 pl-2" style="align-self: center">
      <div class="">Unique Name : {{(bot.bot_unique_name|slice:0:36)+(bot.bot_unique_name.length>36?"...":"")}}</div>
      <div class="">Last Updated By : {{bot.updated_by}} on {{bot.updated_at|date:'mediumDate'}}</div>
    </div>
    <div class="icon2 d-flex justify-content-center">
      <i class="fa fa-users" style="color: #9e9e9e;" *ngIf="bot.is_manager" [title]="bot.child_bots.length + ' children Bots'"></i>
    </div>

    <div class="grid-bot-preview-forth-row d-flex flex-row-reverse bot-strip align-items-center p-2 footer">
      <!-- <span *ngIf="(bot.integrations|integrationImageCount)>4" class="more ml-auto">+{{(bot.integrations|integrationImageCount)}} More</span> -->

      <img *ngFor="let integrationsMasterListItem of ((bot.integrations|integrationLogos:'no_channel'|async))"
           [src]="integrationsMasterListItem?.icon"
           (click)="test(integrationsMasterListItem.key)"
           class="logo-image no-channel-integrations" style="width: 16px;height: 16px" alt="">
      <img *ngFor="let integrationsMasterListItem of ((bot.integrations|integrationLogos:'only_channel'|async))"
           [src]="integrationsMasterListItem?.icon"
           (click)="test(integrationsMasterListItem.key)"
           class="logo-image click-save-wrapper" style="width: 16px;height: 16px" alt="">
      <div class="mr-auto"></div>
      <div *myIf="myEAllActions['Send API']" class="show-on-parent-hover click-save-wrapper" (click)="previewBot()">
        <div *ngIf="bot.bot_type == 'chatbot'"
             title="Click to open chat preview window"
             class="text-sm click-save-wrapper  ">Preview
        </div>
      </div>
      <button (click)="navigateToBotDetailPage($event)" class="show-on-parent-hover  btn-theme btn-theme-primary px-3 mr-2 "
              [ngClass]="{'mr-auto': bot.bot_type !== 'chatbot'}">Edit
      </button>
      <!---->
    </div>

  </div>

  <div *ngIf="showLoader"
       style="position: absolute;top: 0; left: 0;right: 0; bottom: 0; opacity: .2"
       class="d-flex justify-content-center align-items-center bg-secondary">
    <i class="fa fa-gear fa-spin" style="font-size: 20px"></i>
  </div>
</section>


<!--Template for modal-->
<ng-template #template>
  <div class="danger-modal">
    <div class="top-dec"></div>
    <div class="modal-header">
      <h4 class="modal-title mb-2" style="display: flex;justify-content: start;">Delete bot&nbsp;{{bot.name}}&nbsp;
        ?</h4>
      <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>

    <div class="modal-body pt-0">
      <form #form="ngForm">
        <div class="text-center my-1">
          <p class="mb-3">This action cannot be undone.Are you sure you wish to continue?</p>

        </div>
        <button class="btn-theme btn-theme-secondary-outline mr-2" (click)="modalRef.hide()">Cancel</button>
        <button class=" btn-theme btn-theme-danger" (click)="deleteBot()">Delete</button>
      </form>
    </div>
  </div>
</ng-template>


<mat-menu class="cutom-md-menu" #appMenu="matMenu">
  <button mat-menu-item (click)="utilityService.copyToClipboard(bot.bot_access_token)"><i class="fa fa-copy mr-1"></i>Copy Access Token</button>
  <button mat-menu-item (click)="utilityService.copyToClipboard(bot.enterprise_id)"><i class="fa fa-copy mr-1"></i>Copy Enterprise ID</button>
  <button mat-menu-item *myIf="[myEAllActions['Get Pipeline Module'],myEAllActions['Get Integrations'],myEAllActions['Get Bot Knowledge base']]" (click)="openModal(template)"><i class="fa fa-trash mr-1"></i>Delete</button>
  <button mat-menu-item *ngIf="!bot.store_isPinned" (click)="togglePinBotCard(bot, true)"><i class="fa fa-thumb-tack mr-1"></i>Pin</button>
  <button mat-menu-item *ngIf="bot.store_isPinned" (click)="togglePinBotCard(bot, false)">Unpin</button>
</mat-menu>
