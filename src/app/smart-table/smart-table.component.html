
<!--https://stackblitz.com/edit/angular-hbakxo-xctfqy?file=app%2Ftable-filtering-example.ts-->
<div style="display: flex;" *ngIf="showRefreshButton">
  <ng-content class="hide-phone"></ng-content>
  <span style="margin-right: auto"></span>
  <button (click)="refreshData()"
          class="mat-theme-button" mat-button
          style="border: 1px solid rgba(0, 0, 0, 0.12); border-radius: 2px; margin-right: 10px;">
    <mat-icon>refresh</mat-icon>
    Refresh
  </button>
</div>
<input type="text" #headerHoverd value="false" hidden>
<input type="text" #calenderOpened hidden>
<form #tableForm="ngForm" *ngIf="tableData" (click)="handleDataValueClicked($event)"
      style="position: relative; min-height: 80%">
  <app-splash-screen
    *ngIf="isTableEmpty"
    [imageHRef]="'baseline-search-24-px-6.svg'"
    style="position: absolute; top: 50%; left: 50%; transform: translate(-50%)"
    [descriptionText]="noResultsMessage"></app-splash-screen>
  <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
    <!-- Symbol Column -->
    <ng-container *ngFor="let i of displayedColumns">

      <ng-container [matColumnDef]="i">
        <!--table header starts-->
        <th mat-header-cell
            [ngClass]="{'hide-matinput-underline':((headerHoverd.value === 'false') && !formDirty)}"
            (mouseenter)="headerHoverd.value = 'true'"
            (mouseleave)="headerHoverd.value = 'false'"
            *matHeaderCellDef>
          <div
            class="cursor-pointer"
            style="font-size: 13px;color: #9e9e9e; position: relative">

            <div
              style="position: absolute; top: -8px; left: 0px; right: 0 ; bottom: 0; display: flex; flex-direction: column">
              <div style="display: flex; flex-direction: column">
                <span class="fa fa-caret-up"
                   title="Sort descending"
                   style="margin-bottom: 6px"
                   [ngClass]="{'text-bold': sortDir === myESortDir.DES && i===sortedCol}"
                   (click)="sort(i, myESortDir.DES)"></span>
                <span class="fa fa-caret-down"
                   title="Sort Ascending"
                   [ngClass]="{'text-bold': sortDir === myESortDir.ASC && i===sortedCol}"
                   (click)="sort(i, myESortDir.ASC)"></span>
              </div>

              <div
                *ngIf="!(tableData && tableData[0][i].dateRange)"
                [ngClass]="{'hide-matinput-underline pointer-events-none':!(tableData && tableData[0][i].search)}"
                class="search-theme-input-with-search"
                style="position: absolute;top: -3px;left: 10px;height: 35px;display: flex; align-items: center;">
                <span class="fa fa-search"></span>
                <input type="text" class="input-material" style="width: 100%"
                       (keyup.enter)="enterPressedOnFilters()"
                       [name]="i" ngModel [placeholder]="i">
              </div>
            </div>
            <!--text search ends-->

            <!--text search starts-->
            <div *ngIf="(tableData && tableData[0][i].dateRange)"
                 style="position: absolute; top: -12px; left: 10px; right: 0 ; bottom: 0; display: flex">

              <mat-form-field
                floatLabel="never">
                <input matInput
                       [name]="i"
                       ngModel
                       [placeholder]="i"
                       (keyup.enter)="enterPressedOnFilters()"
                       [satDatepicker]="picker">
                <sat-datepicker #picker [rangeMode]="true" (opened)="calenderOpened.value = 'true'"
                                (closed)="calenderOpened.value = 'false'"></sat-datepicker>
                <sat-datepicker-toggle style="background-color: #f0f3f4" matSuffix [for]="picker"></sat-datepicker-toggle>
              </mat-form-field>

            </div>
            <!--text search ends-->
          </div>

        </th>
        <!--table header ends-->

        <td mat-cell *matCellDef="let element">
          <span *ngIf="element[i].type==='button'"></span>
          <span *ngIf="element[i].type==='boolean'">
          <mat-chip-list>
            <mat-chip>{{element[i].value}}</mat-chip>
          </mat-chip-list>
        </span>
          <span *ngIf="element[i].type==='time'">
            <span class="">{{element[i].value|date:"d MMM yy, h:mma"}}</span>
          </span>
          <span *ngIf="element[i].type==='icon'" class="cursor-pointer">
            <span *ngFor="let i of  element[i].value" [matTooltip]="i.name" [class]="i.class + ' mr-1'"
               (click)="actionIconClicked(element.originalSessionData, i.name, $event)"></span>
          </span>
          <span *ngIf="element[i].type==='mat-icon'" class="cursor-pointer">

            <mat-icon *ngFor="let i of  element[i].value" [matTooltip]="i.name"
                      [attr.name]="i.class"
                      (click)="actionIconClicked(element.originalSessionData, i.name, $event)">
              {{i.iconName}}
            </mat-icon>

          </span>
          <span *ngIf="element[i].type==='image'">
          <img style="width: 16px; height: 16px; margin-right: 2px;" [matTooltip]="item.name"
               *ngFor="let item of element[i].value" [src]="item.src" alt="action logo">
        </span>

          <div style="position: relative" class="textval-wrapper">
            <div
              class="textVal"
              [innerHTML]="element[i].value|safeHtml"
              *ngIf="element[i].type!=='button' && element[i].type!=='icon' && element[i].type!=='mat-icon' && element[i].type!=='image' && element[i].type!=='boolean' && element[i].type!=='time'">
            </div>
          </div>
        </td>
      </ng-container>
    </ng-container>
    <tr mat-header-row *matHeaderRowDef="displayedColumns" ></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="selectRow(row)"></tr>
  </table>
  <!--material table ends-->

  <mat-paginator *ngIf="_totalRecords && _totalRecords >10" [length]="_totalRecords"
                 [pageSize]="10"
                 [pageSizeOptions]="[10]"
                 [showFirstLastButtons]="true"
                 [pageIndex]="currentPage-1"
                 [hidePageSize]="true"
                 (page)="goToPage($event)">
  </mat-paginator>

</form>

<ng-template #matIcon let-value="value">
  <em>{{ value|json }}</em>
  <mat-icon [ngClass]="value">
    {{ value }}
  </mat-icon>
</ng-template>
