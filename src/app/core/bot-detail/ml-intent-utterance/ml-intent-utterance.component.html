<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px">
  <h2 class="heading">
    Entities to recognise
  </h2>
  <a *ngIf="(entityList|filterEntities: selectedIntent).length > 0" [matMenuTriggerFor]="appMenu"
     style="text-decoration: none; color: #00abd3; font-size: 13px; cursor: pointer">+ Link entity</a>
</div>

<mat-menu #appMenu="matMenu" yPosition="above" [class]="'entity-list'">
  <button mat-menu-item *ngFor="let entity of entityList|filterEntities: selectedIntent"
          (click)="linkEntityHandler(entity)">{{entity.name}}</button>
</mat-menu>

<div class="example-list" cdkDropList #todoList="cdkDropList" [cdkDropListData]="selectedIntent?.entities||[]"
     (cdkDropListDropped)="drop($event)">
  <table style="border: solid 1px #eaeaea;">
    <tr style="background-color: #eeeeee">
      <th style="width: 5%"></th>
      <th style="width: 25%">Entity name</th>
      <th style="width: 10%">Required</th>
      <th style="width: 15%">Retried</th>
      <th style="width: 25%">Template Key</th>
      <th style="width: 5%"></th>
    </tr>
    <tbody>
    <ng-container *ngIf="selectedIntent">
      <tr class="example-box" *ngFor="let e of selectedIntent.entities" style="min-height: 140px" cdkDrag>
        <ng-container *ngIf="(e|getEntityByName:entityList) as entity">
          <td [ngStyle]="{borderColor: entity.color}"></td>
          <td>{{entity.name}}</td>
          <td>
            <mat-checkbox [checked]="entity.required" [(ngModel)]="e.required" (change)="change(e)"></mat-checkbox>
          </td>
          <td>
            <mat-form-field *ngIf="e.required === true"
                            floatLabel="never"
                            style="margin-bottom: -1.25em; margin-top: -1.25em; width: 50px">
              <input matInput value="1" type="number" [(ngModel)]="e.counter">
            </mat-form-field>
            <span *ngIf="e.required !== true">{{entity.counter || 'None'}}</span>
          </td>
          <td>
            <mat-form-field *ngIf="e.required === true"
                            floatLabel="never"
                            style="margin-bottom: -1.25em; margin-top: -1.25em; width: 100px">
              <input matInput placeholder="Template key" value="Hello" [(ngModel)]="e.template_key">
            </mat-form-field>
            <span *ngIf="e.required !== true">
              {{entity.template_key || 'None'}}
            </span>
          </td>
          <td>
            <i class="fa fa-trash" style="cursor: pointer" (click)="removeEntityHandler(e)"></i>
          </td>
        </ng-container>
      </tr>
    </ng-container>
    </tbody>

  </table>
  <div *ngIf="!selectedIntent || !selectedIntent.entities|| selectedIntent.entities.length===0"
       style="background: white; width: 100%; height: 50px; display: flex; justify-content: center; align-items: center">
    No entities linked yet, link to start using them
  </div>
</div>
