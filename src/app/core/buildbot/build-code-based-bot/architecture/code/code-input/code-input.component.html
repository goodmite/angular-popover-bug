<!--<p>{{selectedVersion.generation_templates|json}}</p>-->
<!--<p>{{editorCodeObj.generation_templates|json}}</p>-->
<div class="p-1 d-flex-column-last-child-flex-grow-1">
  <app-code-version-list [selectedVersion]="selectedVersion" [activeVersion]="activeVersion" [bot]="bot"
    (changeSelectedVersion$)="changeSelectedVersion($event)" (saveSelectedVersion$)="saveSelectedVersion()"
    (downloadAll$)="downloadZip()" (openForkNewVersionModal$)="openForkNewVersionModal(ForkVersiontemplate)">
  </app-code-version-list>
  <!--<button (click)="downloadZip()">download</button>-->

    <div class="row row-tabs child-no-expand-shrink ">
        <div class="col-12">
            <div class="card" style="background-color: transparent">

        <!--tabs start-->
        <div class="card-body p-0 mr-0">
          <ul class="nav nav-tabs theme-tabbing">
            <li class="nav-item" [ngClass]="{'tab-active': activeTab===myEBotVersionTabs.df_template}">
              <i class="fa fa-exclamation-triangle color-danger"
                *ngIf="!!selectedVersion.validation[myEBotVersionTabs.df_template].error"></i>
              <a class="nav-link text-theme-normal d-inline-block"
                (click)="tabClicked(myEBotVersionTabs.df_template)">DF
                Template</a>
            </li>
            <li class="nav-item" [ngClass]="{'tab-active': activeTab===myEBotVersionTabs.df_rules}">
              <i class="fa fa-exclamation-triangle color-danger"
                *ngIf="!!selectedVersion.validation[myEBotVersionTabs.df_rules].error"></i>
              <a class="nav-link text-theme-normal d-inline-block" (click)="tabClicked(myEBotVersionTabs.df_rules)">DF
                Rules</a>
            </li>
            <li class="nav-item text-theme-normal"
              [ngClass]="{'tab-active': activeTab===myEBotVersionTabs.generation_rules}">
              <i class="fa fa-exclamation-triangle color-danger"
                *ngIf="!!selectedVersion.validation[myEBotVersionTabs.generation_rules].error"></i>
              <a class="nav-link d-inline-block" (click)="tabClicked(myEBotVersionTabs.generation_rules)">Generation
                Rules</a>
            </li>
            <li class="nav-item text-theme-normal"
              [ngClass]="{'tab-active': activeTab===myEBotVersionTabs.generation_templates}">
              <i class="fa fa-exclamation-triangle color-danger"
                *ngIf="!!selectedVersion.validation[myEBotVersionTabs.generation_templates].error"></i>
              <a class="nav-link d-inline-block" (click)="tabClicked(myEBotVersionTabs.generation_templates)">Generation
                Template</a>
            </li>
            <li class="nav-item text-theme-normal" [ngClass]="{'tab-active': activeTab===myEBotVersionTabs.workflow}">
              <i class="fa fa-exclamation-triangle color-danger"
                *ngIf="!!selectedVersion.validation[myEBotVersionTabs.workflow].error"></i>
              <a class="nav-link d-inline-block" (click)="tabClicked(myEBotVersionTabs.workflow)">Workflows</a>
            </li>
            <li>
              <!--<button [hidden]="activeTab!==myEBotVersionTabs.generation_templates" (click)="showGenTempUi = !showGenTempUi; convertUiDictToGenTemplateCode()">button123-->
              <!--</button>-->
            <li class="ml-auto gen-templet-toggle d-flex align-items-center"
              *ngIf="activeTab===myEBotVersionTabs.generation_templates">
              <!-- <button [hidden]="activeTab!==myEBotVersionTabs.generation_templates" (click)="showGenTempUi = !showGenTempUi">button</button> -->
              <span>Interface</span>
              <!--<ui-switch *ngIf="showViewChangeToggle" color="rgb(0, 34, 64)"-->
              <!--switchColor="white" name="toggle_gen_templet"-->
              <!--(change)="viewChanged($event)"-->
              <!--[(ngModel)]="showGenTempEditorAndHideGenTempUi"-->
              <!--class="d-flex align-items-center mx-1 "-->
              <!--style="border:none;padding: 0;"-->
              <!--size="small" title="Toggle UI view"></ui-switch>-->
              <mat-slide-toggle *ngIf="showViewChangeToggle" (change)="viewChanged($event)"
                [(ngModel)]="showGenTempEditorAndHideGenTempUi" class="d-flex align-items-center mx-1 " color="primary"
                title="Toggle UI view"></mat-slide-toggle>
              <span>Code</span>

                        </li>
                    </ul>
                    <!--tabs end-->

                </div>
            </div>
        </div>
    </div>
    <!-- code editor starts here -->
    <div class="d-flex" style="height:100%">
        <div
                class="code-editor-row code-editor-row-max position-relative child-expand  d-flex-column-last-child-flex-grow-1">

      <app-code-editor class="child-expand" [hidden]="activeTab!==myEBotVersionTabs.df_template"
        [doShowValidationsIcon]="true" [text]="editorCodeObj[myEBotVersionTabs.df_template]"
        (textChangedEvent)="saveText($event)" (validateClick)="validateCodeTest($event)"></app-code-editor>

      <app-code-editor [hidden]="activeTab!==myEBotVersionTabs.df_rules" [doShowValidationsIcon]="true"
        [text]="editorCodeObj[myEBotVersionTabs.df_rules]" (textChangedEvent)="saveText($event)"
        (validateClick)="validateCodeTest($event)"></app-code-editor>

      <app-code-editor [hidden]="activeTab!==myEBotVersionTabs.generation_rules" [doShowValidationsIcon]="true"
        [text]="editorCodeObj[myEBotVersionTabs.generation_rules]" (textChangedEvent)="saveText($event)"
        (validateClick)="validateCodeTest($event)"></app-code-editor>
      <!--generation template UI starts-->
      <!--<p>{{templateKeyDict|json}}</p>-->
      <!--<p>{{selectedVersion|json}}</p>-->
      <ng-container *ngIf="isGentemplateCodeParsable; else cantParseGenTemplateCodeTemplate">
        <app-code-gentemplate-ui-wrapper
          *ngIf="activeTab===myEBotVersionTabs.generation_templates && buildTab==='code' && !showGenTempEditorAndHideGenTempUi"
          class="row mx-0 px-0 child-expand" [activeTab]="activeTab" [channelList]="channelListClone" [bot]="bot"
          [templateKeyDict]="templateKeyDict"
          (convertUiDictToGenTemplateCode$)="convertUiDictToGenTemplateCode($event)"></app-code-gentemplate-ui-wrapper>
      </ng-container>
      <!--generation template UI ends-->

      <ng-template #cantParseGenTemplateCodeTemplate>
        <div class="d-flex justify-content-center align-items-center"
          style="position:absolute; left: 0; right: 0; bottom: 0;top: 0">
          <i>Can't parse gentemplate code</i>
        </div>
      </ng-template>

      <app-code-editor *ngIf="activeTab===myEBotVersionTabs.generation_templates && showGenTempEditorAndHideGenTempUi"
        [text]="editorCodeObj[myEBotVersionTabs.generation_templates]" (textChangedEvent)="saveText($event)"
        (validateClick)="validateCodeTest($event)">
      </app-code-editor>

      <app-code-editor [hidden]="activeTab!==myEBotVersionTabs.workflow "
        [text]="editorCodeObj[myEBotVersionTabs.workflow]" (textChangedEvent)="saveText($event)"
        (validateClick)="validateCodeTest($event)"></app-code-editor>
    </div>
    <div class="validation-bar"
      *ngIf="activeTab!==myEBotVersionTabs.generation_templates || showGenTempEditorAndHideGenTempUi">
      <div class="dot-indicator">
        <i class="fa fa-check-circle color-primary" *ngIf="!selectedVersion.validation[activeTab].error"></i>
        <i class="fa fa-exclamation-triangle color-danger" *ngIf="!!selectedVersion.validation[activeTab].error"></i>

      </div>
      <div class="validation-toggle cursor-pointer" (click)="validationMessageToggle = !validationMessageToggle">
        <i class="fa fa-angle-double-right" *ngIf='validationMessageToggle'></i>
        <i class="fa fa-angle-double-left" *ngIf='!validationMessageToggle'></i>
      </div>
    </div>
    <div class="validation-message"
      *ngIf="validationMessageToggle &&(activeTab!==myEBotVersionTabs.generation_templates || showGenTempEditorAndHideGenTempUi)">
      <div class="validation-message-heading" *ngIf="!!selectedVersion.validation[activeTab].error">
        Issue found
      </div>
      <div class="validation-message-heading" *ngIf="!selectedVersion.validation[activeTab].error">
        No issue found
      </div>
      <div class="validation-message-data my-1" *ngIf="!!selectedVersion.validation[activeTab].error">
        Error = {{ selectedVersion.validation[activeTab].error_msg}} <br>
        Value = {{ selectedVersion.validation[activeTab].error_line}} <br>
      </div>
      <div class="validation-message-data my-1" *ngIf="!selectedVersion.validation[activeTab].error">
        Validation was successful. You can validate again if you need.
      </div>
    </div>

</div>

<!--modals starts-->
<ng-template #ForkVersiontemplate>
  <div class="primary-modal" style="width: 500px;">
    <div class="modal-header" style="display: block!important;">
      <div class="d-flex">
        <h4 class="modal-title mb-2">Fork to a new version</h4>
        <button type="button" class="close pull-right" aria-label="Close" (click)="dialogRefWrapper.ref.close()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <p class ="pb-20">By default it will be saved and not be activated.</p>
    </div>

    <div class="modal-body">
      <form class="d-flex flex-column" #fork_new_version_form="ngForm" style="align-items: start;">
        <div class="d-flex" style="align-items: center;">
          <div class="mr-4">
            <label for="">Fork from</label>
          </div>
          <mat-form-field style="width: 46px;">
            <mat-select placeholder="Version" [(ngModel)]="forked_version_number" required type="number"
              name="version_id" #select>
              <mat-option *ngFor="let version of bot.store_bot_versions" [value]="version.version">
                {{version.version}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- <div class="col-md-9 px-0 d-flex justify-content-start align-content-end">
          <div class="form-group m-0 mr-4">
          <select class="concept1" [(ngModel)]="forked_version_number" required type="number" name="version_id" #select>
            <option type="button" *ngFor="let version of bot.store_bot_versions">
              <button>{{version.version}}</button>
            </option>
          </select>
          </div>

        </div> -->
        
          <mat-form-field class="example-full-width" style="width: 85%;">
            <input matInput placeholder="Comments on the new version" [(ngModel)]="forked_comments" name="comment">
          </mat-form-field>
        <!-- <div class="col-md-9 px-0 d-flex justify-content-start my-2">
          <textarea type="text" style="width: 100%" [(ngModel)]="forked_comments" name="comment"></textarea>
        </div>
         -->
        <div class="ml-auto pt-4" >
          <p *ngIf="errorMessage" class="text-danger">{{errorMessage}}</p>

          <button class="btn-theme btn-theme-primary-outline mr-1"
            (click)="dialogRefWrapper.ref.close()">Cancel</button>

          <button class="btn-theme btn-theme-primary" (click)="forkNewVersion()">
            Fork new version
          </button>
        </div>

            </form>
        </div>
    </div>
</ng-template>
